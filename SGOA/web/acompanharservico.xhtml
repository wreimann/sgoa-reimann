<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns:p="http://primefaces.org/ui"
       xmlns:h="http://java.sun.com/jsf/html"  
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>Reiman´s Car - Acompanhe o Serviço</title>
        <h:outputStylesheet name="layout.css" library="css" value="text/css" /> 
        <h:outputScript name="hideshow.js" library="js" />
        <h:outputScript name="jquery.tablesorter.min.js" library="js" />
        <h:outputScript name="jquery.equalHeight.js" library="js" />
    </h:head>
    <h:body>
        <header id="header">
            <hgroup>
                <h1 class="site_title">
                    <h:graphicImage id="logoMaster" url="/images/logoReimansCar.png" width="166" height="80" style="margin-top: 5px;"/>
                </h1>
            </hgroup>
        </header> 
        <section id="main" class="full"  >
            <article class="module width_full">
                <header>
                    <h2>Acompanhe seu Veículo</h2>
                </header>
                <div class="module_content">
                    <h:form id="frmConsulta" prependId="false">
                        <p:growl autoUpdate="true" />
                        <h:panelGroup rendered="#{acompanharServicoController.etapa==null}" layout="block" style="margin-top: 20px;">
                            <p:messages id="growl" />
                            <div class="ui-messages-warn ui-corner-all" style="padding-bottom: 0px; padding-top: 0px; ">
                                <span class="ui-messages-warn-icon" style="margin-right: 10px; margin-top: 10px;" ></span>
                                <p>O veículo não possui nenhuma ordem de serviço pendente.</p>
                            </div>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{acompanharServicoController.etapa!=null}" layout="block" style="margin-top: 20px;">
                            <p:messages id="grow" />
                            <p:panelGrid styleClass="semBorda">
                                <p:row>  
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column>  
                                    <p:column><p:outputLabel value="Orçamento" style="font-weight: bold" for="OrcamentoLabel" /></p:column>
                                    <p:column><p:outputLabel id="OrcamentoLabel" value="#{acompanharServicoController.orcamento}"/></p:column>
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                    <p:column><p:outputLabel value="Data Aprovação" style="font-weight: bold;" for="DataLabel"/></p:column>
                                    <p:column><p:outputLabel id="DataLabel" value="#{acompanharServicoController.dataAprovacao}"/></p:column>
                                </p:row>
                                <p:row>  
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                    <p:column><p:outputLabel value="Cliente" style="font-weight: bold;" for="ClienteLabel"/></p:column>
                                    <p:column><p:outputLabel id="ClienteLabel" value="#{acompanharServicoController.cliente}" style="width: 16px;"/></p:column>
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                    <p:column><p:outputLabel value="Veículo" style="font-weight: bold;" for="VeiculoLabel"/></p:column>
                                    <p:column><p:outputLabel id="VeiculoLabel" value="#{acompanharServicoController.veiculo}"/></p:column>
                                </p:row>
                                <p:row>  
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column> 
                                    <p:column><p:outputLabel value="Atividade Atual" style="font-weight: bold;color: blue;" for="AtividadeLabel"/></p:column>
                                    <p:column><p:outputLabel id="AtividadeLabel" value="#{acompanharServicoController.etapa}" /></p:column>

                                </p:row>
                                <p:row>
                                    <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column> 
                                    <p:column><p:outputLabel value="Situação" style="font-weight: bold;color: blue;" for="SituacaoLabel"/></p:column>
                                    <p:column><p:outputLabel id="SituacaoLabel" value="#{acompanharServicoController.situacao}" /></p:column>
                                </p:row>

                            </p:panelGrid>
                            <p:commandButton title="Entre em Contato"  icon="ui-icon-circle-plus" 
                                             value="Entre em Contato" oncomplete="modalPopup.show()"
                                             style="margin-top: 25px;"/>
                            <p:tabView id="tabView" style="margin-top: 25px;"  dynamic="true">
                                <p:tab id="tab2" title="Atividades">  
                                    <p:dataTable var="atividade" 
                                                 value="#{acompanharServicoController.atividades}" lazy="false"
                                                 widgetVar="dataTableAtividade" rowIndexVar="rowIx"
                                                 paginatorPosition="bottom"  
                                                 emptyMessage="Nenhum serviço cadastrado."                   
                                                 rows="10" sortBy="dataEntrada" sortOrder="descending"
                                                 currentPageReportTemplate="Tota de Registros: {totalRecords} - Página: {currentPage}/{totalPages}"
                                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" >
                                        <f:facet name="header">
                                            <div class="tabs_involved">
                                                <h:outputLabel value="Histórico" styleClass="tabs_involved" />                               
                                            </div>
                                        </f:facet>
                                        <p:column headerText="Data Entrada" width="125">
                                            <h:outputText value="#{atividade.dataEntrada}" >
                                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Atividade">
                                            <h:outputText value="#{atividade.etapa}" />
                                        </p:column>
                                        <p:column headerText="Data Saída" width="125">
                                            <h:outputText value="#{atividade.dataSaida}">
                                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Situação" width="100">
                                            <p:outputLabel value="Em Execução" rendered="#{atividade.situacao == 'E'}"   />  
                                            <p:outputLabel value="Cancelado" rendered="#{atividade.situacao == 'A'}"   />  
                                            <p:outputLabel value="Parado" rendered="#{atividade.situacao == 'P'}"   />  
                                            <p:outputLabel value="Fila de Espera" rendered="#{atividade.situacao == 'F'}"   />  
                                            <p:outputLabel value="Concluído" rendered="#{atividade.situacao == 'C'}"   /> 
                                        </p:column>

                                        <p:column headerText="Horas Trab." width="80">
                                            <h:outputText value="#{atividade.horasTrabalhadas}" />
                                        </p:column>
                                        <p:column headerText="Detalhes" width="60">
                                            <p:commandButton alt="Detalhes" title="Detalhes" icon="ui-icon-search"
                                                             oncomplete="modalHistoricoPopup.show()" immediate="true"
                                                             action="#{acompanharServicoController.prepararEvento}"
                                                             update=":frmHistoricoEvento" style="margin-left: 15px;">
                                                <f:setPropertyActionListener value="#{atividade}" target="#{acompanharServicoController.atividade}" />
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>
                                <p:tab id="tab3" title="Fotos" >
                                    <h:panelGroup rendered="#{acompanharServicoController.fotosOS.size()==0}" layout="block" style="margin-top: 20px;">
                                        <div class="ui-messages-warn ui-corner-all" style="padding-bottom: 0px; padding-top: 0px; ">
                                            <span class="ui-messages-warn-icon" style="margin-right: 10px; margin-top: 10px;" ></span>
                                            <p>Nenhuma foto encontrada.</p>
                                        </div>
                                    </h:panelGroup>
                                    <p:galleria value="#{acompanharServicoController.fotosOS}" 
                                                var="galeria" effect="slide" effectSpeed="2000" showCaption="false" 
                                                showFilmstrip="true" panelHeight="300" panelWidth="400" frameHeight="50" frameWidth="50"
                                                rendered="#{acompanharServicoController.fotosOS.size()>0}">
                                        <p:graphicImage value="/fotos/#{galeria.id}.jpg" cache="false" width="400" height="300" 
                                                        title="#{galeria.nomeArquivo}" alt="#{galeria.nomeArquivo}"  />

                                    </p:galleria>
                                </p:tab>
                            </p:tabView>
                        </h:panelGroup>
                    </h:form>
                </div>
                <footer>
                </footer>
            </article>

            <p:dialog  widgetVar="modalHistoricoPopup" modal="true" width="750" height="340" resizable="false"
                       showEffect="fade" header="Detalhes da atividade" id="dialogHistorico" >
                <h:form id="frmHistoricoEvento" prependId="false">
                    <p:dataTable var="evento" value="#{acompanharServicoController.eventos}" lazy="false"
                                 widgetVar="dataTableEventos" rowIndexVar="rowIx"
                                 paginatorPosition="bottom"  
                                 emptyMessage="Nenhum resultado encontrado."                   
                                 rows="6" paginator="true"
                                 currentPageReportTemplate="Tota de Registros: {totalRecords} - Página: {currentPage}/{totalPages}"
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" >
                        <p:column headerText="Ocorrência" width="125">
                            <h:outputText value="#{evento.dataOcorrencia}" >
                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Evento" width="140">
                            <h:outputText value="#{evento.tipoEvento.toString()}" />
                        </p:column>
                        <p:column headerText="Mensagem">
                            <h:outputText value="#{evento.descricao}" />
                        </p:column>
                        <p:column headerText="Data" width="125">
                            <h:outputText value="#{evento.dataInicioParada}">
                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Fotos"  width="40">
                            <p:commandButton alt="Fotos" title="Fotos" icon="ui-icon-search" 
                                             oncomplete="dialogGaleria.show();" 
                                             update=":frmGaleria"
                                             action="#{acompanharServicoController.changeFoto}">
                                <f:setPropertyActionListener value="#{evento}" target="#{acompanharServicoController.evento}" /> 
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:dialog>

            <p:dialog widgetVar="dialogGaleria" modal="true" id="dGaleria"
                      width="440"  dynamic="true" position="center" resizable="false" appendToBody="false"
                      header="Fotos">
                <h:form id="frmGaleria" prependId="false"  >
                    <h:panelGroup rendered="#{acompanharServicoController.fotos.size()==0}" layout="block" style="margin-top: 20px;">
                        <div class="ui-messages-warn ui-corner-all" style="padding-bottom: 0px; padding-top: 0px; ">
                            <span class="ui-messages-warn-icon" style="margin-right: 10px; margin-top: 10px;" ></span>
                            <p>Nenhuma foto encontrada.</p>
                        </div>
                    </h:panelGroup>
                    <p:galleria value="#{acompanharServicoController.fotos}" id="galeriaModal"
                                var="galeria" effect="slide" effectSpeed="2000" showCaption="false" 
                                showFilmstrip="true"  
                                panelHeight="300" panelWidth="400" frameHeight="50" frameWidth="50"
                                rendered="#{acompanharServicoController.fotos.size()>0}">
                        <p:graphicImage value="/fotos/#{galeria.id}.jpg" cache="false" width="400" height="300" 
                                        title="#{galeria.nomeArquivo}" alt="#{galeria.nomeArquivo}"  />

                    </p:galleria>
                </h:form>

            </p:dialog>
            <p:dialog widgetVar="modalPopup" modal="true" width="450"  resizable="false"
                      showEffect="fade" header="Contato" id="dialog">
                <h:form id="frmEvento">
                    <p:messages autoUpdate="true" />
                    <p:fieldset>
                        <label>Mensagem*</label>
                        <p:inputTextarea value="#{acompanharServicoController.informacao}" required="true"
                                         requiredMessage="O campo 'Mensagem' é obrigatório."/>
                    </p:fieldset>
                    <h:panelGroup layout="block" style="margin-top: 10px; float: right;" >
                        <p:commandButton actionListener="#{acompanharServicoController.adicionarEvento}"
                                         update=":frmEvento" value="Enviar" oncomplete="validarFormDialog(xhr, status, args)" />

                    </h:panelGroup>
                </h:form>
            </p:dialog>
            <script type="text/javascript">
                function validarFormDialog(xhr, status, args) {
                    if (args.validationFailed || args.exceptionThrown) {
                        jQuery('#dialog').effect("shake", {times: 3}, 100);
                    } else {
                        modalPopup.hide();

                    }
                }
            </script> 
        </section>
    </h:body>
</html>

