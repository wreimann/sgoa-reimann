<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns:p="http://primefaces.org/ui"
       xmlns:h="http://java.sun.com/jsf/html"  
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>Reiman´s Car - Acompanhe o Serviço</title>
        <h:outputStylesheet name="layout.css" library="css" value="text/css" /> 
        <h:outputScript name="hideshow.js" library="js" />
        <h:outputScript name="jquery.tablesorter.min.js" library="js" />
        <h:outputScript name="jquery.equalHeight.js" library="js" />
    </h:head>
    <h:body>
        <p:ajaxStatus id="ajaxStatusMaster" onstart="statusDialog.show();" oncomplete="statusDialog.hide();"/>  

        <p:dialog modal="true" widgetVar="statusDialog" header="Carregando..." 
                  draggable="false" closable="false">  
            <p:graphicImage value="/images/ajax-loader.gif" />  
        </p:dialog>
        <header id="header" >
            <hgroup>
                <h1 class="site_title" style="width: 160px;">
                    <h:graphicImage id="logoMaster" url="/images/logoReimansCar.png"  style="margin-top: 5px;"/>
                </h1>
                <h2 class="section_title" style="width: 70%;">Reiman´s Car - Recuperadora de Veículos</h2>
                <div class="btn_view_site" style="float: right;">
                    <h:outputLink value="http://www.reimanscar.com.br">Sair</h:outputLink>
                </div>
            </hgroup>
        </header> 
        <section id="main" class="full" sytle="margin-top:0;" >
            <article class="module width_full">
                <header>
                    <h2>Andamento do serviço</h2>
                </header>
                <div class="module_content" style="margin-bottom: 30px;">
                    <h:form id="frmConsulta" prependId="false">
                        <p:growl autoUpdate="true" />
                        <h:panelGroup rendered="#{acompanharServicoController.etapa==null}" layout="block" style="margin-top: 20px;">
                            <p:messages id="growl" />
                            <div class="ui-messages-warn ui-corner-all" style="padding-bottom: 0px; padding-top: 0px; ">
                                <span class="ui-messages-warn-icon" style="margin-right: 10px; margin-top: 10px;" ></span>
                                <p>O veículo não possui nenhuma ordem de serviço em andamento.</p>
                            </div>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{acompanharServicoController.etapa!=null}" layout="block" >
                            <p:messages id="grow" />
                            <div style="width: 100%; display:block; min-height: 410px;">
                                <div style="width: 65%; float: left;">
                                    <p:panelGrid styleClass="semBorda" >
                                        <p:row>  
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                            <p:column>
                                                <p:outputLabel value="Cliente: " style="font-weight: bold;" for="ClienteLabel"/>
                                                <p:outputLabel id="ClienteLabel" value="#{acompanharServicoController.cliente}" style="width: 16px;"/>
                                            </p:column>
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                            <p:column>
                                                <p:outputLabel value="Veículo: " style="font-weight: bold;" for="VeiculoLabel"/>
                                                <p:outputLabel id="VeiculoLabel" value="#{acompanharServicoController.veiculo}"/>
                                            </p:column>
                                        </p:row>
                                        <p:row>  
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column>  
                                            <p:column>
                                                <p:outputLabel value="Orçamento: " style="font-weight: bold" for="OrcamentoLabel" />
                                                <p:outputLabel id="OrcamentoLabel" value="#{acompanharServicoController.orcamento}"/> 
                                            </p:column>
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                            <p:column>
                                                <p:outputLabel value="Data Aprovação: " style="font-weight: bold;" for="DataLabel"/>
                                                <p:outputLabel id="DataLabel" value="#{acompanharServicoController.dataAprovacao}"/>
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span> </p:column>
                                            <p:column>
                                                <p:outputLabel value="Previsão Entrega: " style="font-weight: bold;" for="DataLabel1"/>
                                                <p:outputLabel id="DataLabel1" value="#{acompanharServicoController.dataPrevEntrega}"/>
                                            </p:column>
                                        </p:row>
                                        <p:row>  
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column> 
                                            <p:column>
                                                <p:outputLabel value="Atividade Atual: " style="font-weight: bold;" for="AtividadeLabel"/>
                                                <p:outputLabel id="AtividadeLabel" value="#{acompanharServicoController.etapa}" style="color: blue;" />
                                            </p:column>
                                            <p:column><span class="ui-button-icon-left ui-icon ui-c ui-icon-arrow-1-e"></span></p:column> 
                                            <p:column>
                                                <p:outputLabel value="Situação: " style="font-weight: bold;" for="SituacaoLabel"/>
                                                <p:outputLabel id="SituacaoLabel" value="#{acompanharServicoController.situacao}" style="color: blue;"/>
                                            </p:column>
                                        </p:row>

                                    </p:panelGrid>

                                    <p:commandButton title="Entre em Contato"  icon="ui-icon-circle-plus" 
                                                     value="Entre em Contato" oncomplete="modalPopup.show()"
                                                     style="margin-top: 15px; margin-bottom: 15px;"/>

                                    <p:dataTable var="atividade" 
                                                 value="#{acompanharServicoController.atividades}" lazy="false"
                                                 widgetVar="dataTableAtividade" rowIndexVar="rowIx"
                                                 paginatorPosition="bottom"  
                                                 paginator="true"
                                                 emptyMessage="Nenhum serviço cadastrado."                   
                                                 rows="5" sortBy="dataEntrada" sortOrder="descending"
                                                 currentPageReportTemplate="Total de Registros: {totalRecords} - Página: {currentPage}/{totalPages}"
                                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" >
                                        <f:facet name="header">
                                            <div class="tabs_involved">
                                                <h:outputLabel value="Histórico do Serviço" styleClass="tabs_involved" />                               
                                            </div>
                                        </f:facet>
                                        <p:column headerText="Data Entrada" width="125">
                                            <h:outputText value="#{atividade.dataEntrada}" >
                                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Atividade">
                                            <h:outputText value="#{atividade.etapa}" />
                                        </p:column>
                                        <p:column headerText="Data Saída" width="125">
                                            <h:outputText value="#{atividade.dataSaida}">
                                                <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Situação" width="100">
                                            <p:outputLabel value="Em Execução" rendered="#{atividade.situacao == 'E'}"   />  
                                            <p:outputLabel value="Cancelado" rendered="#{atividade.situacao == 'A'}"   />  
                                            <p:outputLabel value="Parado" rendered="#{atividade.situacao == 'P'}"   />  
                                            <p:outputLabel value="Fila de Espera" rendered="#{atividade.situacao == 'F'}"   />  
                                            <p:outputLabel value="Concluído" rendered="#{atividade.situacao == 'C'}"   /> 
                                        </p:column>

                                        <p:column headerText="Detalhes" width="60">
                                            <p:commandButton alt="Detalhes" title="Detalhes" icon="ui-icon-search"
                                                             oncomplete="modalHistoricoPopup.show()" immediate="true"
                                                             action="#{acompanharServicoController.prepararEvento}"
                                                             update=":frmHistoricoEvento" style="margin-left: 15px;">
                                                <f:setPropertyActionListener value="#{atividade}" target="#{acompanharServicoController.atividade}" />
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </div>
                                <div id="fotosDiv" style="width: 35%; float: right;">
                                    <h:panelGroup rendered="#{acompanharServicoController.fotosOS.size() == 0}" 
                                                  layout="block" style="margin-left: 20px;" >
                                        <div class="ui-messages-warn ui-corner-all" style="padding-bottom: 0px; padding-top: 0px; ">
                                            <span class="ui-messages-warn-icon" style="margin-right: 10px; margin-top: 10px;" ></span>
                                            <p>Nenhuma foto do veículo foi adicionada.</p>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="margin-left: 20px; position: absolute !important;" >
                                        <p:galleria value="#{acompanharServicoController.fotosOS}" autoPlay="false"
                                                    rendered="#{acompanharServicoController.fotosOS.size() > 0}"
                                                    var="galeria" effect="slide" effectSpeed="50" showCaption="false" 
                                                    showFilmstrip="true" panelHeight="300" panelWidth="400" frameHeight="50" frameWidth="50">
                                            <p:graphicImage value="/fotos/#{galeria.id}.jpg" cache="false" width="400" height="300" 
                                                            title="#{galeria.nomeArquivo}" alt="#{galeria.nomeArquivo}"  />

                                        </p:galleria>
                                    </h:panelGroup>
                                </div>
                            </div>

                        </h:panelGroup>
                    </h:form>
                    <div class="spacer"></div>
                </div>
                <div class="spacer"></div>
                <footer style="height: 35px;">
                    <p style="text-align: center; margin: 0px; margin-top: 5px;">
                        <b>Rua Rodolfo Bernardelli, 697 - Curitiba - Paraná / Telefone: (41)3277-3031 / contato@reimanscar.com.br 
                        </b>
                    </p>
                </footer>
            </article>

            <div class="spacer"></div>
        </section>
        <p:dialog  widgetVar="modalHistoricoPopup" modal="true" width="750" height="340" resizable="false"
                   showEffect="fade" header="Detalhes da atividade" >
            <h:form id="frmHistoricoEvento" prependId="false">
                <p:dataTable var="evento" value="#{acompanharServicoController.eventos}" lazy="false"
                             widgetVar="dataTableEventos" rowIndexVar="rowIx"
                             paginatorPosition="bottom"  
                             emptyMessage="Nenhum resultado encontrado."                   
                             rows="5" paginator="true"
                             currentPageReportTemplate="Total de Registros: {totalRecords} - Página: {currentPage}/{totalPages}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" >
                    <p:column headerText="Ocorrência" width="125">
                        <h:outputText value="#{evento.dataOcorrencia}" >
                            <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Evento" width="140">
                        <h:outputText value="#{evento.tipoEvento.toString()}" />
                    </p:column>
                    <p:column headerText="Mensagem">
                        <h:outputText value="#{evento.descricao}" />
                    </p:column>
                    <p:column headerText="Data Parada/Reinicio" width="125">
                        <h:outputText value="#{evento.dataInicioParada}">
                            <f:convertDateTime type="both" pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="modalPopup" modal="true" width="450"  resizable="false"
                  showEffect="fade" header="Contato" id="dialog">
            <h:form id="frmEvento">
                <p:messages autoUpdate="true" />
                <p:fieldset>
                    <label>Mensagem*</label>
                    <p:inputTextarea value="#{acompanharServicoController.informacao}" required="true"
                                     requiredMessage="O campo 'Mensagem' é obrigatório."/>
                </p:fieldset>
                <h:panelGroup layout="block" style="margin-top: 10px; float: right;" >
                    <p:commandButton actionListener="#{acompanharServicoController.adicionarEvento}"
                                     update=":frmEvento" value="Enviar" oncomplete="validarFormDialog(xhr, status, args)" />

                </h:panelGroup>
            </h:form>
        </p:dialog>
        <script type="text/javascript">
            function validarFormDialog(xhr, status, args) {
                if (args.validationFailed || args.exceptionThrown) {
                    jQuery('#dialog').effect("shake", {times: 3}, 100);
                } else {
                    modalPopup.hide();

                }
            }
        </script> 


    </h:body>
</html>

